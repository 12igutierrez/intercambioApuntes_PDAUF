<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${apunte.titulo}">Detalle del apunte</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<main class="container">

    <!-- CARD PRINCIPAL DEL APUNTE -->
    <section class="detalle-card">
        <h1 th:text="${apunte.titulo}">T√≠tulo</h1>
        <div class="detalle-meta">
            <span>üìò <strong th:text="${apunte.asignatura.nombre}"></strong></span>
            <span>üë§ <span th:text="${apunte.usuario.username}"></span></span>
        </div>
        <!-- üîí ACCIONES PARA PROPIETARIO O ADMIN -->
        <div th:if="${#authorization.expression('isAuthenticated()')
             and (apunte.usuario.username == #authentication.name
             or #authorization.expression('hasRole(''ADMIN'')'))}"
             class="acciones-apunte">
            <a th:href="@{/apuntes/{id}/editar(id=${apunte.id})}"
               class="btn">
                ‚úèÔ∏è Editar
            </a>
            <form th:action="@{/apuntes/{id}/eliminar(id=${apunte.id})}"
                  method="post"
                  style="display:inline">
                <button type="submit"
                        class="btn btn-danger"
                        onclick="return confirm('¬øSeguro que quieres eliminar este apunte?')">
                    üóëÔ∏è Eliminar
                </button>
            </form>
        </div>
        <p class="detalle-descripcion"
           th:text="${apunte.descripcion}">
            Descripci√≥n del apunte
        </p>
    </section>

    <!-- COMENTARIOS -->
    <section class="bloque">
        <h2>Comentarios</h2>
        <div th:if="${#lists.isEmpty(comentarios)}" class="mensaje-vacio">
            No hay comentarios todav√≠a.
        </div>
        <div class="comentarios">
            <div class="comentario"
                 th:each="comentario : ${comentarios}">
                <strong th:text="${comentario.usuario.username}"></strong>
                <p th:text="${comentario.contenido}"></p>
            </div>
        </div>
    </section>

    <!-- FORMULARIO COMENTARIO -->
    <section class="bloque">
        <h2>A√±adir comentario</h2>
        <div th:if="${!#authorization.expression('isAuthenticated()')}"
             class="mensaje-vacio">
            Debes iniciar sesi√≥n para comentar.
            <br><br>
            <a th:href="@{/login}" class="btn">Iniciar sesi√≥n</a>
        </div>
        <form th:if="${#authorization.expression('isAuthenticated()')}"
              th:action="@{/apuntes/{id}/comentario(id=${apunte.id})}"
              th:object="${nuevoComentario}"
              method="post"
              class="form-card">
            <textarea th:field="*{contenido}"
                      placeholder="Escribe tu comentario..."
                      required></textarea>
            <button type="submit" class="btn">
                Enviar comentario
            </button>
        </form>
    </section>

    <!-- VALORACIONES -->
    <section class="bloque">
        <h2>Valoraciones</h2>
        <div th:if="${#lists.isEmpty(valoraciones)}" class="mensaje-vacio">
            No hay valoraciones todav√≠a.
        </div>
        <ul class="valoraciones">
            <li th:each="valoracion : ${valoraciones}">
                ‚≠ê <span th:text="${valoracion.puntuacion}"></span>/5
            </li>
        </ul>
        <div th:if="${valoracionUsuario != null}" class="mensaje-vacio">
            Tu valoraci√≥n:
            ‚≠ê <strong th:text="${valoracionUsuario.puntuacion}"></strong>/5
        </div>
        <div th:if="${valoracionUsuario == null
                 and !#authorization.expression('isAuthenticated()')}"
             class="mensaje-vacio">
            Debes iniciar sesi√≥n para valorar.
            <br><br>
            <a th:href="@{/login}" class="btn">Iniciar sesi√≥n</a>
        </div>
        <form th:if="${valoracionUsuario == null
                  and #authorization.expression('isAuthenticated()')}"
              th:action="@{/apuntes/{id}/valoracion(id=${apunte.id})}"
              th:object="${nuevaValoracion}"
              method="post"
              class="form-inline">
            <select th:field="*{puntuacion}" required>
                <option value="">Puntuar</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
            <button type="submit" class="btn">
                Enviar
            </button>
        </form>
    </section>
    <a href="/" class="btn">‚Üê Volver al listado</a>
</main>
</body>
</html>

